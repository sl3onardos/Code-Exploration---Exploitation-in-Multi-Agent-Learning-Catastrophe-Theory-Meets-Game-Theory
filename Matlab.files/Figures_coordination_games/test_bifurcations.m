clear all

%Avoid numerical instabilities at 0 and 1.
epsilon = 1e-7;
L       = epsilon;
U       = 1-epsilon;
xbar    = 5;
ybar    = xbar;

set(groot,'defaultAxesTickLabelInterpreter','latex','defaulttextinterpreter','latex','defaultLegendInterpreter','latex');
clr   = [0.301 0.745 0.933]; %clr = [0.929 0.694 0.125]; %green 
clr   = [0 0.447 0.741]; %blue

fig1  = figure(1);

%Define the game and some useful quantities k1,k2,xmix,ymix.
A = [2 0; 0 1];
B = [1 0; 0 2];
n = size(A,1);
I = eye(n);

k1   = A(1,1)-A(2,1)-A(1,2)+A(2,2);
k2   = B(1,1)-B(2,1)-B(1,2)+B(2,2);
xmix = (B(2,2)-B(2,1))/k2;
ymix = (A(2,2)-A(1,2))/k1;
p    = ceil(A(1,1));

% Figure 1: QRE surface and exploration path
myfun1 = @(g_x,g_y,u_x) k1.*(xbar-g_x).*exp(-log(exp(-k2.*(ybar-g_y).*(u_x-xmix))+1))-k1.*(xbar-g_x).*ymix+log(1-u_x)-log(u_x);
fs     = fimplicit3(myfun1,[2 xbar 2 ybar L U],'MeshDensity',50);
%clr   = [0.301 0.745 0.933]; %clr = [0.929 0.694 0.125]; %green 
fs.EdgeColor       = '#555555';
fs.AmbientStrength = 0.7;
fs.FaceAlpha       = 0.7;
clr                = [0.3010 0.7450 0.9330];
fs.FaceColor       = clr;
camlight(0,0);
view([45 40]); 
%view([-125 25]);
xlabel('$\delta_1=\alpha_1/\beta_1$', 'Position',[3.290632862116476,1.435887905411534,-0.099647537240323]);
ylabel('$\delta_2=\alpha_2/\beta_2$', 'Position',[5.502171105963975,3.652526457144178,-0.098214813489346]);
zlabel('$P(a_1)$');
zlim([0 1]);
grid on
%title('Pitchfork bifurcation','FontSize', 10)
exportgraphics(fig1,['figure_pitch_bif.png'],'BackgroundColor','white','Resolution','500')

fig2 = figure(2);
%Define the game and some useful quantities k1,k2,xmix,ymix.
A = 1.5*[3 0; 2 1.5];
B = 1.5*[3 2; 0 1.5];
n = size(A,1);
I = eye(n);

k1   = A(1,1)-A(2,1)-A(1,2)+A(2,2);
k2   = B(1,1)-B(2,1)-B(1,2)+B(2,2);
xmix = (B(2,2)-B(2,1))/k2;
ymix = (A(2,2)-A(1,2))/k1;
p    = ceil(A(1,1));

% Figure 2: QRE surface and exploration path
myfun2 = @(g_x,g_y,u_x) k1.*(xbar-g_x).*exp(-log(exp(-k2.*(ybar-g_y).*(u_x-xmix))+1))-k1.*(xbar-g_x).*ymix+log(1-u_x)-log(u_x);
fs     = fimplicit3(myfun2,[2 xbar 2 ybar L U],'MeshDensity',50);
%clr   = [0.301 0.745 0.933]; %clr = [0.929 0.694 0.125]; %green 
fs.EdgeColor       = '#555555';
fs.AmbientStrength = 0.7;
fs.FaceAlpha       = 0.7;
clr                = [0.3010 0.7450 0.9330];
fs.FaceColor       = clr;
camlight(0,0);
% for k = 1:45
%     figure(k);
%     fs = fimplicit3(myfun2,[2 xbar 2 ybar L U],'MeshDensity',50);
%     view([k 45]);
% end
view([45 40]);
xlabel('$\delta_1=\alpha_1/\beta_1$', 'Position',[3.290632862116476,1.435887905411534,-0.099647537240323]);
ylabel('$\delta_2=\alpha_2/\beta_2$', 'Position',[5.502171105963975,3.652526457144178,-0.098214813489346]);
zlabel('$P(a_1)$');
zlim([0 1]);
grid on
%title('Saddle-node bifurcation','FontSize', 10)
%pos = get(gcf,'Position')
%set(gcf, 'Position', [pos(1) pos(2) pos(3) 0.8*pos(4)])
exportgraphics(fig2,['figure_saddle_bif.png'],'BackgroundColor','white','Resolution','500')