clear all
axis tight manual
set(groot,'defaultAxesTickLabelInterpreter','latex','defaulttextinterpreter','latex','defaultLegendInterpreter','latex');

A = 1.8*[3 0; 2 1.5];
B = 1.8*[3 2; 0 1.5];
n = size(A,1);
I = eye(n);

k1   = A(1,1)-A(2,1)-A(1,2)+A(2,2);
k2   = B(1,1)-B(2,1)-B(1,2)+B(2,2);
xmix = (B(2,2)-B(2,1))/k2;
ymix = (A(2,2)-A(1,2))/k1;
p    = ceil(A(1,1));

epsilon = 1e-7;
L       = epsilon;
U       = 1-epsilon;
xbar    = 5;
ybar    = xbar;

v = VideoWriter('media_hunt.avi','Motion JPEG AVI');
v.Quality = 100;
v.FrameRate = 4;
open(v);

myfun = @(g_x,g_y,u_x) k1.*(xbar-g_x).*exp(-log(exp(-k2.*(ybar-g_y).*(u_x-xmix))+1))-k1.*(xbar-g_x).*ymix+log(1-u_x)-log(u_x);
quiver3(4.1,4.1,1,-1.34,-0.28,-0.16, 'b', 'LineWidth',1);
hold on
quiver3(4.1,4.1,1,-0.28,-1.34,-0.23, 'b', 'LineWidth',1);
hold on
fs  = fimplicit3(myfun,[2 xbar 2 ybar L U],'MeshDensity',50);

str = {'Single branch of the saddle-node bifurcation curve'};
text(3.11,5.11,1.07,str,'Color', 'b');
text(2.5,2.5,1,'$3$ QRE','Color','r');
text(2.5,4.5,0.2,'$1$ QRE','Color','r');
text(4.5,2.5,0.5,'$1$ QRE','Color','r');
fs.EdgeColor       = '#999999';
%fs.EdgeColor       = 'none';
fs.LineWidth       = 0.01;
fs.AmbientStrength = 0.7;
fs.FaceAlpha       = 0.7;
clr                = [0.3010 0.7450 0.9330];
fs.FaceColor       = clr;
xlabel('$\delta_x$');
ylabel('$\delta_y$');
zlabel('QRE');
title('\textbf{Stag Hunt}');
camlight(0,0);
view([-45 30]);
frame  = getframe(gcf);
writeVideo(v,frame);

exportgraphics(gcf,'figure_presentation_media_hunt.png','BackgroundColor','white','Resolution','500')

% for k = -360:5:-45
%     view([-360-k-45 30]);
%     frame  = getframe(gcf);
%     writeVideo(v,frame);
% end
% 
% for k = 0:5:60
%     view([-360 30+k]);
%     frame  = getframe(gcf);
%     writeVideo(v,frame);
% end
% 
% fs.EdgeColor = 'none';
% for k = 1:20
%     frame  = getframe(gcf);
%     writeVideo(v,frame);
% end
% 
% close(v);
% exportgraphics(gcf,'figure_appendix_media_hunt.png','BackgroundColor','white','Resolution','500')


% x1 = [0.7 0.3];
% x2 = [0.7 0.6];
% y1 = [0.7 0.61];
% y2 = [0.7 0.3];
% annotation('textarrow',x1,y1);
% annotation('arrow',x2,y2);
% str = {'Two branches of', 'the saddle-node','bifurcation curve'};
% text(4,4.4,1.2,str);
% text(2.5,2.5,1,'$3$ QRE');
% text(2.5,2.5,1,'$3$ QRE');
% text(2.5,4.5,1,'$1$ QRE');
% text(4.5,2.5,1,'$1$ QRE');
% text(2.9,3.15,1,'Cusp point');
% x3 = [0.44 0.54];
% y3 = [0.44 0.54];
% annotation('arrow',x3,y3);
%fs.EdgeColor       = 'none';
%x1 = [0.7 0.3];
%x2 = [0.7 0.6];
%y1 = [0.7 0.61];
%y2 = [0.7 0.3];
%annotation('textarrow',x1,y1);
%annotation('arrow',x2,y2);
%x3 = [0.44 0.54];
%y3 = [0.44 0.54];
%annotation('arrow',x3,y3);
% frame  = getframe(gcf);
% writeVideo(v,frame);
% pause(2);